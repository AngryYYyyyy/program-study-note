# 学习目标

> 了解网络发展背景, 对局域网/广域网的概念有基本认识; 
>
> 了解网络协议的意义, 重点理解TCP/IP五层结构模型; 
>
> 学习网络传输的基本流程, 理解封装和分用;
>
> 学习MAC、IP地址

# 计算机网络的发展

## 1、发展趋势

> 由独立到互联
>
> 由短距离变长距离
>
> 跨主机网络通信需要解决的问题：可靠性、效率、定位

## 2、局域网（LAN）(碰撞)

> - 范围：局域网是指在相对较小的范围内建立的网络，通常限制在一个建筑物、办公室、校园或者某个有限的地理区域内。
> - 连接方式：局域网通常使用以太网（Ethernet）或Wi-Fi等有线或无线技术进行连接。
> - 传输速度：局域网的传输速度较高，通常以千兆位/秒（Gbps）或更高的速度进行数据传输。
> - 用途：局域网常用于组织内部的资源共享、文件共享、打印共享、内部通信和协作等应用。

## 3、广域网（WAN）

> - 范围：广域网是指在相对较大的范围内建立的网络，可以跨越城市、国家甚至跨越大陆。
> - 连接方式：广域网使用各种传输媒介，如电话线、光纤、无线电、卫星等，传输信息均是0、1信号，以建立远距离通信连接。
> - 传输速度：广域网的传输速度相对较低，受制于物理距离和传输介质等因素，通常以兆位/秒（Mbps）为单位。
> - 用途：广域网用于实现跨地域的远程访问、远程办公、跨组织的数据共享和互联互通等应用，如互联网即为一种广域网。

## 4、网络与计算机体系结构的关系

#### 1）I/O总线

> I/O总线是用于连接计算机系统和外部设备的通信通道，负责传输输入输出数据和控制信号。它是计算机与外部设备之间的接口，实现数据的输入和输出。

#### 2）系统总线

> ==系统总线是计算机内部各个组件之间进行数据传输和通信的通道==。它连接了计算机的处理器、内存、输入输出控制器等主要组件，实现它们之间的数据交换和协调。

#### 3）理解与冯诺依曼体系关系

> 冯诺依曼体系本质上也可以看成一个小型网络，通过总线进行通信和数据交换。多主机互联也可以看成宏观上的冯诺依曼体系，网络就充当了总线的角色，用于连接多个主机，使它们能够互相通信和共享资源。

# 网络协议

> 协议是一种约定，但还不够
>
> 约定一个共同的标准，就是网络协议
>
> ==网络协议是计算机网络中用于规定通信设备之间进行数据交换和通信的规则和约定==。它定义了数据的格式、传输方式、错误检测与纠正、网络拓扑和通信流程等，确保不同设备能够正确地进行通信和数据交换。

## 1、网络协议分层

> 网络协议通常按照分层结构进行组织，以实现模块化和分工合作的原则。

#### 1）软件分层的优点

> 软件解耦、便于软件维护、问题归类
>
> 同时也可以作为网络协议分层的优点

#### 2）网络分层的特点

> ==同层协议都认为可以直接通信，忽略底层细节，因此都有自己的协议==

## 2、网络协议参考模型

#### 1）OSI模型

> OSI模型过于复杂，在很多情况下难以实现，例如表示层、会话层往往需要由用户决定而不是设计者

![image-20230626094709149](C:\Users\40500\AppData\Roaming\Typora\typora-user-images\image-20230626094709149.png)

> - 应用层（Application Layer）：提供应用程序之间的通信服务，包括HTTP、FTP、SMTP等协议。
> - 表示层（Presentation Layer）：负责数据格式的转换和加密解密，确保不同系统之间的数据能够正确解释。
> - 会话层（Session Layer）：管理和协调应用程序之间的会话和连接。
> - 传输层（Transport Layer）：提供端到端的可靠数据传输和错误恢复，其中常用的协议有TCP和UDP。
> - 网络层（Network Layer）：处理网络间的数据传输和路由选择，负责将数据从源主机传输到目标主机，其中IP协议是其中最重要的协议。
> - 数据链路层（Data Link Layer）：负责物理介质上的数据传输和帧的传递，包括以太网、Wi-Fi等协议。
> - 物理层（Physical Layer）：处理物理介质上的原始比特流，将数据从一个节点传输到另一个节点。

#### 2）TCP/IP模型

> TCP/IP是一组协议的代名词，它还包括许多协议，组成了TCP/IP协议簇。
>
>  TCP/IP通讯协议采用了5层的层级结构，每一层都呼叫它的下一层所提供的网络来完成自己的需求。
>
> 1. 应用层（Application Layer）：负责定义应用程序之间的通信规则，常见的协议包括HTTP、FTP、SMTP等。
> 2. 传输层（Transport Layer）：==提供端到端的数据传输服务，确保数据的可靠传输和错误恢复==。常见的协议包括TCP（传输控制协议）和UDP（用户数据报协议）。
> 3. 网络层（Network Layer）：==负责地址管理和路由选择，将数据从源主机定位到目标主机==。常见的协议包括IP（互联网协议）和ICMP（Internet控制消息协议）。路由器(Router)工作在网路层
> 4. 数据链路层（Data Link Layer）：==负责设备之间的数据帧的传送和识别==。常见的协议包括以太网、Wi-Fi、PPP等。交换机(Switch)工作在数据链路层。
> 5. 物理层（Physical Layer）：==负责光/电信号的传递方式==。它包括物理连接、电压、电流等技术细节。物理层的能力决 定了最大传输速率、传输距离、抗干扰性等. 集线器(Hub)工作在物理层。

#### 3）两者的关系

![image-20230626094750311](C:\Users\40500\AppData\Roaming\Typora\typora-user-images\image-20230626094750311.png)

## 3、网络协议与操作系统关系

> 网络协议栈是在操作系统中实现的，负责管理和处理网络通信的功能，隶属于操作系统
>
> 体系结构直接决定数据包在主机内进行流动时，会按照==自顶向下（封装）或自底向上（解包）==的顺序经过不同的协议层，每个层级负责添加或去除相应的协议头部信息。

# 网络传输的基本流程

## 1、传输流程

![image-20230626094909993](C:\Users\40500\AppData\Roaming\Typora\typora-user-images\image-20230626094909993.png)

## 2、数据的封装和解包

> 不同的协议层对数据包有不同的称谓,==在传输层叫做段(segment)==,==在网络层叫做数据报 (datagram)==,==在链路层叫做帧(frame)==。
>
> 这种分层的封装和分用机制提供了灵活性和可扩展性，使不同层级的协议能够独立地进行开发和更新。决定了网络同层协议都认为可以直接通信，忽略底层细节，

#### 1）封装

> 在网络通信中，数据经常被封装在一层层的协议头部中以形成数据包。这个过程被称为封包或封装（Encapsulation）。
>
> 在数据的封装过程中，数据从高层向低层逐层封装，每个层级添加相应的协议头部信息，也叫做报头。
>
> 一般而言，任何报头里一定存在支持封装和分用的字段。

#### 2）解包

> 当数据到达目标后，每一层的协议头部都被移除，以获取原始的数据。这个过程被称为解包。
>
> 在这个过程中，接收端会根据每层协议头部的信息来确定如何处理数据。

#### 3）有效载荷

> 在计算机网络中，"有效载荷"（Payload）是指==被传输的实际数据==，而不是被用于传输或封装数据的协议头部信息。
>
> 当两个计算机系统进行通信时，它们会将数据封装在一个数据包中，这个数据包包括头部信息和实际的数据内容。头部信息包括源和目标地址、包的大小等等，这些都是用来在网络中传输和路由这个包的信息。实际的数据内容就是有效载荷。
>
> 在网络协议栈（如TCP/IP模型或OSI模型）中，不同层级的有效载荷有不同的含义。例如，在传输层（如TCP或UDP），有效载荷通常是指封装在TCP或UDP报文中的上层数据（通常是来自应用层的数据）。然而在网络层（如IP），有效载荷可能是整个TCP或UDP报文（包括它们自己的头部和有效载荷）。所以，==“有效载荷”的确切含义可能会根据上下文变化==。
>
> ==有效载荷是在当前层去除封装后的数据，即在目标同层应该向上传递的数据。==

#### 4）分用

> 分用（Demultiplexing）：这是一个==将从单一源接收的信息分发到多个接收者的过程==。在计算机网络中，分用通常在传输层进行。例如，在TCP/IP模型中，一个计算机可能同时与服务器上的多个进程进行通信。服务器的TCP层会根据到达的数据包的端口号将数据分发给正确的进程，这就是分用的过程。此外，分用也可以在更低层次，如网络层或数据链路层进行。
>

## 3、局域网通信原理

> 1. 物理层连接：局域网中的计算机、服务器、打印机等设备通过物理层的连接介质，如以太网电缆或者Wi-Fi无线信号，与局域网的交换机或无线接入点相连。
> 2. 以太网帧传输：局域网中的数据传输采用以太网帧格式。数据被封装成以太网帧，其中包括目标设备的MAC地址、源设备的MAC地址、数据部分以及校验和等信息。
> 3. MAC地址寻址：以太网帧中的目标MAC地址用于将数据传送到正确的接收设备。交换机在局域网中进行MAC地址学习，根据设备的MAC地址表，将数据转发到目标设备。
> 4. CSMA/CD协议：局域网采用CSMA/CD（Carrier Sense Multiple Access with Collision Detection）协议来协调多个设备共享局域网的传输介质。设备在发送数据前会先侦听传输介质上的信号，如果检测到传输介质空闲，就发送数据；如果多个设备同时发送数据导致冲突，设备会检测到冲突并执行退避算法，等待一段随机的时间后再尝试发送。

## 4、跨网络通信原理

> 跨网络通信是指在不同的局域网之间进行数据传输和通信。常见的跨网络通信涉及广域网（Wide Area Network，WAN）或者互联网。

> 1. 路由器连接：==不同的局域网通过路由器连接起来，路由器是连接不同网络的设备，负责在网络之间转发数据==。每个局域网有一个唯一的IP子网地址，路由器通过查找目标IP地址来决定数据的转发路径。
> 2. 路由选择：路由器根据路由表中的路由信息，选择最佳的路径将数据包传输到目标网络。路由表中包含了与其他网络相连的路由器的信息，以及对应的出口接口和距离度量等。
> 3. IP地址寻址：跨网络通信使用IP协议进行数据传输。源设备根据目标设备的IP地址，将数据封装成IP数据包，并通过路由器转发到目标网络。
> 4. 网络层协议：在跨网络通信中，常用的网络层协议是IP（Internet Protocol）。IP协议负责将数据包从源设备传输到目标设备，同时还涉及到分片、重组、路由选择等功能。即使跨网络，IP以上的协议发送和接受的数据是一样的，因此网络也被称之为IP网络，屏蔽了底层网络的差异
> 5. 网络间连接：跨网络通信可能需要经过多个中间网络或者互联网来实现。在互联网中，数据经过多个路由器和互联网服务提供商（ISP）的网络进行转发，最终到达目标网络。

# 网络的地址管理

## 1、MAC地址

> MAC地址是用于在==局域网（LAN）中唯一标识网络设备（如计算机、服务器、路由器、交换机等）的物理地址==，用于在数据链路层（如以太网）中识别设备。它是由网络适配器（如网卡）的制造商提前分配的，MAC地址通常由六个字节组成，以冒号分隔，例如：00:0a:95:9d:68:16。MAC地址是全球唯一的，用于在局域网中进行设备间的数据传输。

## 2、IP地址

> IP地址是用于在==网络中唯一标识设备的逻辑地址，用于在网络层识别设备==。IP地址的分配由网络管理员或互联网服务提供商（ISP）进行，确保网络中的设备可以正确地进行数据交换和通信。
>
> IP地址被分为IPv4和IPv6两个版本。
>
> IPv4地址：IPv4（Internet Protocol Version 4）是目前广泛使用的IP地址版本。IPv4地址是一个32位的二进制数，通常表示为四个用点分隔的十进制数，如192.168.0.1。IPv4地址由网络号和主机号组成，网络号用于标识网络，主机号用于标识网络中的具体设备。
>
> IPv6地址的长度更长，提供了更多的地址空间，以满足日益增长的网络设备需求。
>

## 3、端口号

> 在使用TCP/IP协议栈的网络中，端口号是用于在传输层（例如TCP或UDP）识别特定进程或服务的数字标签，用于识别设备内部的特定进程。端口号范围从0到65535，其中0到1023的端口被定义为“知名端口”，通常用于互联网上的主要服务，如HTTP（端口80），HTTPS（端口443），FTP（端口21）等。这使得数据包能够被正确地路由到它应该去的应用程序。
>
> 网络通信的本质是进程间的通信
>
> 端口号到进程唯一性映射，但反过来却不是。





